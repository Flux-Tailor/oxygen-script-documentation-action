name: Oxygen XML/JSON - Generate Documentation
description: Generate XML Schema (XSD), XSLT, WSDL, JSON Schema and OpenAPI documentation in HTML format using Oxygen Scripting
branding:
  icon: 'book-open'
  color: 'blue'
inputs:
  docsVersion:
    description: 'Version of documentation to create/overwrite'
    required: true

runs:
  using: "composite"
  steps:
    - name: Checkout main repo.
      uses: actions/checkout@v3.3.0

    - name: Checkout Documentation Template repo.
      uses: actions/checkout@v3.3.0
      with:
        repository: Flux-Tailor/oxygen-script-documentation
        path: scripting

    - name: Checkout rate-plan-documentation repo.
      uses: actions/checkout@v3.3.0
      with:
        repository: Flux-Tailor/rate-plan-documentation
        path: rate-plan-documentation

    - name: Setup Gradle
      uses: gradle/gradle-build-action@v2

    - name: Make gradlew executable
      run: chmod +x ./scripting/build/gradlew
      shell: bash

    - name: Build with Gradle
      run: |
        cd scripting/build 
        ./gradlew generateDoc -PschemaFile=all_rate_plan_schemas.xsd -PinnerBuild=false --info --stacktrace --build-cache
        cp -r scripting/doc/* ${{ GITHUB_WORKSPACE }}/rate-plan-documentation/doc/OxygenDocs/rate-plan-schema-docs/${{ inputs.docsVersion }}
      shell: bash

   - name: Create Pull Request
     uses: peter-evans/create-pull-request@v7
     with:
        path: rate-plan-documentation
        commit-message: "[Flux Bot] New version of schema documentation"

